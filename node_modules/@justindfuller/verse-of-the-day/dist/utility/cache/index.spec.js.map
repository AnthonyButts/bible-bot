{"version":3,"sources":["../../../src/utility/cache/index.spec.js"],"names":["t","expireAsync","stub","HMSETAsync","onCall","returns","client","setHash","true","calledWith","false","called","hgetallAsync","getHash","is","get","spy","set"],"mappings":"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","file":"index.spec.js","sourcesContent":["import test from 'ava';\r\nimport sinon from 'sinon';\r\nimport index from './index';\r\n\r\ntest('Calls expire with roughly midnight time', async (t) => {\r\n  const expireAsync = sinon.stub();\r\n  const HMSETAsync = sinon.stub();\r\n  HMSETAsync.onCall(0).returns(true);\r\n  const client = {\r\n    expireAsync,\r\n    HMSETAsync,\r\n  };\r\n  await index(client).setHash('TestKey', 'FakeValue');\r\n  t.true(expireAsync.calledWith('TestKey'));\r\n});\r\n\r\ntest('Does not call expire on failure', async (t) => {\r\n  const expireAsync = sinon.stub();\r\n  const HMSETAsync = sinon.stub();\r\n  HMSETAsync.onCall(0).returns(false);\r\n  const client = {\r\n    expireAsync,\r\n    HMSETAsync,\r\n  };\r\n  await index(client).setHash('TestKey', 'FakeValue');\r\n  t.false(expireAsync.called);\r\n});\r\n\r\ntest('getHash wraps getall', async (t) => {\r\n  const client = {\r\n    hgetallAsync: sinon.stub(),\r\n  };\r\n  client.hgetallAsync.onCall(0).returns('Test return value');\r\n  client.hgetallAsync.onCall(1).returns('Test return value 1');\r\n  const getHash = await index(client).getHash('Test');\r\n  t.is(getHash, 'Test return value');\r\n  const get = await index(client).get('Test');\r\n  t.is(get, 'Test return value 1');\r\n});\r\n\r\ntest('Set wraps setHash', async (t) => {\r\n  const client = {\r\n    HMSETAsync: sinon.spy(),\r\n  };\r\n  await index(client).set('BibleID', 'key', 'value');\r\n  t.true(client.HMSETAsync.calledWith('BibleID:key', 'value'));\r\n});\r\n\r\ntest('Get wraps getHash', async (t) => {\r\n  const client = {\r\n    hgetallAsync: sinon.spy(),\r\n  };\r\n  await index(client).get('BibleID', 'key');\r\n  t.true(client.hgetallAsync.calledWith('BibleID:key'));\r\n});\r\n"]}