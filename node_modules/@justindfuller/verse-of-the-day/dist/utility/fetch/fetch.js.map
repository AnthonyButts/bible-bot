{"version":3,"sources":["../../../src/utility/fetch/fetch.js"],"names":["url","cacheKey","getHash","cached","headers","Authorization","process","env","APIKEY","resolveWithFullResponse","JSON","parse","response","json","data","setHash","fetchFromApi","module","exports"],"mappings":";;;;;;;;;;;;;;;sFAGA,iBAA4BA,GAA5B;AAAA;AAAA;AAAA;AAAA;AAAA;AACQC,oBADR,cAC4BD,GAD5B;AAAA;AAAA,mBAEuB,uBAAQE,OAAR,CAAgBD,QAAhB,CAFvB;;AAAA;AAEQE,kBAFR;AAIQC,mBAJR,GAIkB;AACdJ,sBADc;AAEdI,uBAAS;AACPC,2CAAwBC,QAAQC,GAAR,CAAYC,MAAZ,IAAsB,EAA9C;AADO,eAFK;AAKdC,uCAAyB;AALX,aAJlB;;AAAA,iBAYMN,MAZN;AAAA;AAAA;AAAA;;AAAA,6CAaWO,KAAKC,KAAL,CAAWR,OAAOS,QAAlB,CAbX;;AAAA;AAAA,0BAgBqCT,MAhBrC;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAgBqD,yBAAMH,GAAN,EAAWI,OAAX,CAhBrD;;AAAA;AAAA;;AAAA;AAgBQQ,oBAhBR;AAAA;AAAA,mBAiBqBA,SAASC,IAAT,EAjBrB;;AAAA;AAiBQA,gBAjBR;AAkBQC,gBAlBR,GAkBeD,KAAKD,QAlBpB;AAAA;AAAA,mBAmBQ,uBAAQG,OAAR,CAAgBd,QAAhB,EAA0B,EAAEW,UAAU,yBAAeE,IAAf,CAAZ,EAA1B,CAnBR;;AAAA;AAAA,6CAoBSA,IApBT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAeE,Y;;;;;AAHf;;;;AACA;;;;;;AAyBAC,OAAOC,OAAP,GAAiBF,YAAjB","file":"fetch.js","sourcesContent":["import fetch from 'node-fetch';\r\nimport cache from './../cache';\r\n\r\nasync function fetchFromApi(url: string): Promise<any> {\r\n  const cacheKey = `fetch:${url}`;\r\n  const cached = await cache().getHash(cacheKey);\r\n\r\n  const headers = {\r\n    url,\r\n    headers: {\r\n      Authorization: `Basic ${process.env.APIKEY || ''}`,\r\n    },\r\n    resolveWithFullResponse: true,\r\n  };\r\n\r\n  if (cached) {\r\n    return JSON.parse(cached.response);\r\n  }\r\n\r\n  const response: { body: string } = cached || await fetch(url, headers);\r\n  const json = await response.json();\r\n  const data = json.response;\r\n  await cache().setHash(cacheKey, { response: JSON.stringify(data) });\r\n  return data;\r\n}\r\n\r\nmodule.exports = fetchFromApi;\r\n"]}