{"version":3,"sources":["../../../../src/feature/dailyVerse/chapter/chapter.js"],"names":["chapter","props","chapterURL","cacheKey","res","chapters","getHash","stored","randomNumber","length","randomChapter","data","chapterID","id","setHash","getRandomChapter","book","version","bibleID","url","fullChapter","fullText","getFullChapter","cache","module","exports"],"mappings":";;;;;;;;;;;;;;AAAA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAGA,SAASA,OAAT,GAA+D;AAAA;AAAA,wFAM7D,iBAAgCC,KAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AACQC,wBADR,GACqB,yBAASD,KAAT,EAAgBD,OADrC;AAEQG,sBAFR,GAEmB,yBAAYF,KAAZ,EAAmBD,OAFtC;AAAA;AAAA,qBAGoB,qBAAaE,UAAb,CAHpB;;AAAA;AAGQE,iBAHR;AAIQC,sBAJR,GAImBD,IAAIC,QAJvB;AAAA;AAAA,qBAKuBC,QAAQH,QAAR,CALvB;;AAAA;AAKQI,oBALR;AAMQC,0BANR,GAMuB,iBAAID,MAAJ,EAAY,cAAZ,KAA+B,oBAAgBF,SAASI,MAAT,GAAkB,CAAlC,CANtD;AAOQC,2BAPR,GAOwB,iBAAIL,QAAJ,QAAkBG,YAAlB,QAAmC,EAAnC,CAPxB;AAQQG,kBARR,GAQe,sBAAc,EAAd,EAAkBV,KAAlB,EAAyB;AACpCD,yBAASU,cAAcV,OADa;AAEpCY,2BAAWF,cAAcG;AAFW,eAAzB,CARf;;AAYEC,sBAAQX,QAAR,EAAkB,EAAEK,0BAAF,EAAlB;AAZF,+CAaSG,IAbT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAN6D;;AAAA,oBAM9CI,gBAN8C;AAAA;AAAA;AAAA;;AAAA;AAAA,yFAsB7D,kBAA8BC,IAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AACQf,mBADR,GACgB,sBAAc,EAAd,EAAkBe,IAAlB,EAAwB,EAAEC,SAASD,KAAKE,OAAhB,EAAxB,CADhB;AAEQC,iBAFR,GAEc,yBAASlB,KAAT,EAAgBmB,WAF9B;AAAA;AAAA,qBAGoB,qBAAaD,GAAb,CAHpB;;AAAA;AAGQf,iBAHR;AAIQO,kBAJR,GAI4B,sBAAc,EAAd,EAAkBK,IAAlB,EAAwB;AAChDK,0BAAU,iBAAIjB,GAAJ,EAAS,gCAAT;AADsC,eAAxB,CAJ5B;AAAA,gDAOSO,IAPT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAtB6D;;AAAA,oBAsB9CW,cAtB8C;AAAA;AAAA;AAAA;;AAAA,MAA9CC,KAA8C;;AAAA,eAIzDA,OAJyD;AAAA,MAE3DjB,OAF2D,UAE3DA,OAF2D;AAAA,MAG3DQ,OAH2D,UAG3DA,OAH2D;;AAgC7D,SAAO;AACLC,sCADK;AAELO;AAFK,GAAP;AAID;;AAEDE,OAAOC,OAAP,GAAiBzB,OAAjB","file":"chapter.js","sourcesContent":["import { get } from 'lodash';\r\nimport getCacheKey from './../../cacheKeys';\r\nimport endpoint from './../../endpoints';\r\nimport getRandomNumber from './../../../utility/math/math';\r\nimport fetchFromApi from './../../../utility/fetch/fetch';\r\nimport defaultCache from './../../../utility/cache';\r\nimport type { Chapter, Book, FullChapter } from './../../../types/Verse.type';\r\n\r\nfunction chapter(cache: typeof defaultCache = defaultCache): * {\r\n  const {\r\n    getHash,\r\n    setHash,\r\n  } = cache();\r\n\r\n  async function getRandomChapter(props: Book): Promise<Chapter> {\r\n    const chapterURL = endpoint(props).chapter;\r\n    const cacheKey = getCacheKey(props).chapter;\r\n    const res = await fetchFromApi(chapterURL);\r\n    const chapters = res.chapters;\r\n    const stored = await getHash(cacheKey);\r\n    const randomNumber = get(stored, 'randomNumber') || getRandomNumber(chapters.length - 1);\r\n    const randomChapter = get(chapters, `[${randomNumber}]`, {});\r\n    const data = Object.assign({}, props, {\r\n      chapter: randomChapter.chapter,\r\n      chapterID: randomChapter.id,\r\n    });\r\n    setHash(cacheKey, { randomNumber });\r\n    return data;\r\n  }\r\n\r\n  async function getFullChapter(book: Chapter): Promise<FullChapter> {\r\n    const props = Object.assign({}, book, { version: book.bibleID });\r\n    const url = endpoint(props).fullChapter;\r\n    const res = await fetchFromApi(url);\r\n    const data: FullChapter = Object.assign({}, book, {\r\n      fullText: get(res, 'search.result.passages[0].text'),\r\n    });\r\n    return data;\r\n  }\r\n\r\n  return {\r\n    getRandomChapter,\r\n    getFullChapter,\r\n  };\r\n}\r\n\r\nmodule.exports = chapter;\r\n"]}