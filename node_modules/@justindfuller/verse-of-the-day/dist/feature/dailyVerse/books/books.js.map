{"version":3,"sources":["../../../../src/feature/dailyVerse/books/books.js"],"names":["bookArray","cacheKey","bookIndex","getHash","Number","length","setHash","getRandomIndex","getRandomBook","props","url","books","res","applicator","bookName","getBookByName","book","createData","getBook","bookAbbr","bookID","copyright","filterBooks","name","toLowerCase","indexOf","filter","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;uFAyCA,iBAA8BA,SAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AACQC,oBADR,GACmB,2BAAYC,SAD/B;AAAA;AAAA,mBAEwBC,QAAQF,QAAR,CAFxB;;AAAA;AAEMC,qBAFN;;AAGEA,wBAAYE,OAAO,iBAAIF,SAAJ,EAAe,WAAf,CAAP,CAAZ;;AAHF,gBAKO,yBAAiBA,SAAjB,CALP;AAAA;AAAA;AAAA;;AAMIA,wBAAY,oBAAaF,UAAUK,MAAvB,CAAZ;AANJ;AAAA,mBAOUC,QAAQL,QAAR,EAAkB,EAAEC,oBAAF,EAAlB,CAPV;;AAAA;AAAA,6CAUSA,SAVT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAeK,c;;;;;;uFAaf,kBAA6BP,SAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACkCO,eAAeP,SAAf,CADlC;;AAAA;AACQE,qBADR;AAAA,8CAESF,UAAUE,SAAV,CAFT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAeM,a;;;;;;uFAKf,kBAAuBC,KAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AACQC,eADR,GACsB,yBAASD,KAAT,EAAgBE,KADtC;AAAA;AAAA,mBAEoB,qBAAaD,GAAb,CAFpB;;AAAA;AAEQE,eAFR;AAGQC,sBAHR,GAGqBJ,MAAMK,QAAN,KAAmB,QAAnB,GAA8BN,aAA9B,GAA8CO,aAHnE;AAAA;AAAA,mBAImCF,WAAWD,IAAID,KAAf,EAAsBF,MAAMK,QAA5B,CAJnC;;AAAA;AAIQE,gBAJR;AAAA,8CAKSC,WAAWR,KAAX,EAAkBO,IAAlB,CALT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAeE,O;;;;;AA3Df;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;aAMI,sB;IAFFf,O,UAAAA,O;IACAG,O,UAAAA,O;;AAiBF,SAASW,UAAT,CAAoBR,KAApB,EAA2BO,IAA3B,EAAkD;AAChD,SAAO,sBAAc,EAAd,EAAkBP,KAAlB,EAAyB;AAC9BK,cAAU,iBAAIE,IAAJ,EAAU,MAAV,CADoB;AAE9BG,cAAU,iBAAIH,IAAJ,EAAU,MAAV,CAFoB;AAG9BI,YAAQ,iBAAIJ,IAAJ,EAAU,IAAV,CAHsB;AAI9BK,eAAW,iBAAIL,IAAJ,EAAU,WAAV;AAJmB,GAAzB,CAAP;AAMD;;AAED,SAASD,aAAT,CAAuBf,SAAvB,EAAkDc,QAAlD,EAAkF;AAChF,MAAMQ,cAAc,SAAdA,WAAc;AAAA,QAAGC,IAAH,QAAGA,IAAH;AAAA,WAAcA,KAAKC,WAAL,GAAmBC,OAAnB,CAA2BX,SAASU,WAAT,EAA3B,IAAqD,CAAC,CAApE;AAAA,GAApB;AACA,SAAOxB,UAAU0B,MAAV,CAAiBJ,WAAjB,EAA8B,CAA9B,CAAP;AACD;;AA4BDK,OAAOC,OAAP,GAAiBV,OAAjB","file":"books.js","sourcesContent":["import { get } from 'lodash';\r\nimport cacheKeys from './../../cacheKeys';\r\nimport endpoint from './../../endpoints';\r\nimport fetchFromApi from './../../../utility/fetch/fetch';\r\nimport getRandomInt from './../../../utility/math/math';\r\nimport cache from './../../../utility/cache';\r\nimport type { Book } from './../../../types/Verse.type';\r\n\r\nconst {\r\n  getHash,\r\n  setHash,\r\n} = cache();\r\n\r\ntype BookResponse = {\r\n  name: string,\r\n  abbr: string,\r\n  id: string,\r\n  copyright: string,\r\n};\r\n\r\ntype Props = {\r\n  theme: string;\r\n  title: string;\r\n  bookName: string;\r\n  bibleID: string;\r\n};\r\n\r\nfunction createData(props, book: BookResponse): * {\r\n  return Object.assign({}, props, {\r\n    bookName: get(book, 'name'),\r\n    bookAbbr: get(book, 'abbr'),\r\n    bookID: get(book, 'id'),\r\n    copyright: get(book, 'copyright'),\r\n  });\r\n}\r\n\r\nfunction getBookByName(bookArray: BookResponse[], bookName: string): BookResponse {\r\n  const filterBooks = ({ name }) => name.toLowerCase().indexOf(bookName.toLowerCase()) > -1;\r\n  return bookArray.filter(filterBooks)[0];\r\n}\r\n\r\nasync function getRandomIndex(bookArray: BookResponse[]): Promise<number> {\r\n  const cacheKey = cacheKeys().bookIndex;\r\n  let bookIndex = await getHash(cacheKey);\r\n  bookIndex = Number(get(bookIndex, 'bookIndex'));\r\n\r\n  if (!Number.isInteger(bookIndex)) {\r\n    bookIndex = getRandomInt(bookArray.length);\r\n    await setHash(cacheKey, { bookIndex });\r\n  }\r\n\r\n  return bookIndex;\r\n}\r\n\r\nasync function getRandomBook(bookArray: BookResponse[]): Promise<BookResponse> {\r\n  const bookIndex: number = await getRandomIndex(bookArray);\r\n  return bookArray[bookIndex];\r\n}\r\n\r\nasync function getBook(props: Props): Promise<Book> {\r\n  const url: string = endpoint(props).books;\r\n  const res = await fetchFromApi(url);\r\n  const applicator = props.bookName === 'random' ? getRandomBook : getBookByName;\r\n  const book: BookResponse = await applicator(res.books, props.bookName);\r\n  return createData(props, book);\r\n}\r\n\r\nmodule.exports = getBook;\r\n"]}