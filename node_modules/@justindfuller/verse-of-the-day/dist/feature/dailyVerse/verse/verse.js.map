{"version":3,"sources":["../../../../src/feature/dailyVerse/verse/verse.js"],"names":["verse","original","cacheKey","size","newVerseNumber","setHash","setVerseNumber","getHash","verseNumber","Number","getVerseNumber","identifier","verseArray","length","pickVerse","chapter","verses","versesResponse","getVerses","getRandomVerse","theme","verseObj","createVerseData","cache","randomVerse","reference","text","module","exports"],"mappings":"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","file":"verse.js","sourcesContent":["import { get } from 'lodash';\r\nimport getCacheKey from './../../cacheKeys';\r\nimport endpoint from './../../endpoints';\r\nimport normalizeText from './../../../utility/text/text';\r\nimport fetchFromApi from './../../../utility/fetch/fetch';\r\nimport getRandomNumber from './../../../utility/math/math';\r\nimport defaultCache from './../../../utility/cache';\r\nimport type { Verse, FullChapter } from './../../../types/Verse.type';\r\n\r\nfunction verse(cache: typeof defaultCache = defaultCache): * {\r\n  const {\r\n    getHash,\r\n    setHash,\r\n  } = cache();\r\n\r\n  async function setVerseNumber(original: number, cacheKey: string, size: number): Promise<number> {\r\n    let newVerseNumber = original;\r\n    if (!Number.isInteger(newVerseNumber)) {\r\n      newVerseNumber = getRandomNumber(size);\r\n      await setHash(cacheKey, { newVerseNumber });\r\n    }\r\n    return newVerseNumber;\r\n  }\r\n\r\n  async function getVerseNumber(cacheKey: string, size: number): Promise<number> {\r\n    let verseNumber = await getHash(cacheKey);\r\n    verseNumber = Number(get(verseNumber, 'newVerseNumber'));\r\n    return setVerseNumber(verseNumber, cacheKey, size);\r\n  }\r\n\r\n  async function pickVerse(identifier: string, verseArray) {\r\n    const cacheKey: string = getCacheKey({ identifier }).verse;\r\n    const verseNumber = await getVerseNumber(cacheKey, verseArray.length);\r\n    // default to first verse just in case.\r\n    return verseArray[verseNumber];\r\n  }\r\n\r\n  function createVerseData(chapter = {}, randomVerse = {}) {\r\n    return Object.assign({}, chapter, {\r\n      verse: randomVerse.verse,\r\n      reference: randomVerse.reference,\r\n      text: normalizeText(randomVerse.text),\r\n    });\r\n  }\r\n\r\n  async function getVerses(chapter) {\r\n    const verses: string = endpoint(chapter).verse;\r\n    const versesResponse = await fetchFromApi(verses);\r\n    return versesResponse.verses;\r\n  }\r\n\r\n  async function getRandomVerse(chapter: FullChapter): Promise<Verse> {\r\n    const verseArray: Verse[] = await getRandomVerse.getVerses(chapter);\r\n    const verseObj: Verse = await getRandomVerse.pickVerse(chapter.theme, verseArray);\r\n    return getRandomVerse.createVerseData(chapter, verseObj);\r\n  }\r\n\r\n  getRandomVerse.pickVerse = pickVerse;\r\n  getRandomVerse.createVerseData = createVerseData;\r\n  getRandomVerse.getVerseNumber = getVerseNumber;\r\n  getRandomVerse.setVerseNumber = setVerseNumber;\r\n  getRandomVerse.getVerses = getVerses;\r\n  return getRandomVerse;\r\n}\r\n\r\nmodule.exports = verse;\r\n"]}